<html>
<head>
 <title>Mon client</title>
 <script src="socket.io.js"></script>
 <style>
 *{
	 font-family:arial,verdana;
 }
 #monApplication{
	display:none;
 }
 #zoneMessage{
	border:2px solid #ccc;
	background:#eee;
	padding:20px;
 }
 .serveur{
	 color:#444;
	 font-style:italic;
 }
 </style>
</head>
<body>

<script>
var tableauDesMessages=Array();	
	
var socket = io('http://localhost:8080');

socket.on('message',function(messageRecuDuServeur){
 
 tableauDesMessages.push( messageRecuDuServeur );
 
 rafraichirMessages();
 
});

socket.on('demarrerMessagerie',function(data){
	montrer('monApplication');
	
	ecrireHTML('auteur',data.nom);
	
	cacher('connexionBouton');
});

function rafraichirMessages(){
	
	var sHtml='';
	for(var i=tableauDesMessages.length;i>0;i--){
		var auteurDuMessage=tableauDesMessages[(i-1)].auteur;
		var message=tableauDesMessages[(i-1)].message;
		
		if(auteurDuMessage=='Serveur'){
				sHtml+='<p class="serveur">'+message+'</p>';
		}else{
				sHtml+='<p><strong>'+auteurDuMessage+'</strong>: '+message+'</p>';
		}
		
	}
	
	ecrireHTML('zoneMessage',sHtml);
}

function ecrireHTML(id_,html_){
		
	var monElement=document.getElementById(id_);
	if(monElement){
		monElement.innerHTML=html_;
	} 
}
function montrer(id_){
	var monElement=document.getElementById(id_);
	if(monElement){
		monElement.style.display='block';
	} 
}
function cacher(id_){
	var monElement=document.getElementById(id_);
	if(monElement){
		monElement.style.display='none';
	} 
}
  
function seConnecter(){
	var monNom=prompt('Votre nom');
	if(monNom){	  
		socket.emit('demanderConnexion',{nom:monNom} );
	}
}


function askMessage(){
 var myMessage=prompt('Votre message');

 if(myMessage){
  socket.emit('message',{message:myMessage});
 }
}
</script>

<div id="monApplication">
 <div id="zoneMessage">
 </div>

 <strong id="auteur"></strong> <input id="sendButton" type="button" value="Message!" onclick="askMessage()"/>
</div>

<input id="connexionBouton" type="button" value="Se connecter" onclick="seConnecter()"/>


</body>

</html>
